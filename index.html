<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schoolcord</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="/socket.io/socket.io.js" defer></script>
<script src="js/firebase-lite.js" defer></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DX01P3PE8W"></script>
<link rel="stylesheet" href="css/base.css">
<link rel="stylesheet" href="css/sidebar.css">
<link rel="stylesheet" href="css/voice.css">
<link rel="stylesheet" href="css/chat-layout.css">
<link rel="stylesheet" href="css/chat-voice-panel.css">
<link rel="stylesheet" href="css/chat-messages.css">
<link rel="stylesheet" href="css/chat-input.css">
<link rel="stylesheet" href="css/member.css">
<link rel="stylesheet" href="css/modals.css">
<link rel="stylesheet" href="css/extras.css">
<script src="js/app-core.js" defer></script>
<script src="js/server-cleanup.js" defer></script>
<script src="js/servers.js" defer></script>
<script src="js/channels.js" defer></script>
<script src="js/messages.js" defer></script>
<script src="js/members.js" defer></script>
<script src="js/admin.js" defer></script>
<script src="js/permissions.js" defer></script>
<script src="js/ui.js" defer></script>
<script src="js/voice.js" defer></script>
<script src="js/startup-updates.js" defer></script>
<script async src="js/google.js"></script>
<link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner" aria-hidden="true"></div>
</div>

<div class="server-list" id="serverList">
  <div class="server-icon home" onclick="goHome()" title="Home"><i class="fa-solid fa-house"></i></div>
  <div class="server-divider"></div>
</div>

<div class="channel-sidebar" id="channelSidebar">
  <div class="server-header" onclick="showServerMenu(event)">
    <span id="serverName">Home Server</span>
    <span class="dropdown-icon"><i class="fa-solid fa-chevron-down"></i></span>
  </div>

  <div class="channels-container" id="channelsContainer">
    <div class="channel-category" id="directMessagesCategory" style="display:none;">
      <div class="category-header">
        <span><i class="fa-solid fa-chevron-down"></i></span>
        <span>DIRECT MESSAGES</span>
        <span onclick="event.stopPropagation(); showModal('addFriend')" style="cursor:pointer;opacity:0.7;"><i class="fa-solid fa-plus"></i></span>
      </div>
      <div id="directMessagesList"></div>
    </div>
    <div class="channel-category" id="friendRequestsCategory" style="display:none;">
      <div class="category-header">
        <span><i class="fa-solid fa-chevron-down"></i></span>
        <span>FRIEND REQUESTS</span>
      </div>
      <div id="friendRequestsList"></div>
    </div>
    <div class="channel-category" id="discoveryCategory" style="display:none;">
      <div class="category-header">
        <span><i class="fa-solid fa-chevron-down"></i></span>
        <span>DISCOVERY</span>
      </div>
      <div id="discoveryList"></div>
    </div>

    <div class="channel-category" id="textChannelsCategory">
      <div class="category-header" onclick="toggleCategory(this)">
        <span><i class="fa-solid fa-chevron-down"></i></span>
        <span>TEXT CHANNELS</span>
        <span onclick="event.stopPropagation(); showModal('addChannel')" style="cursor:pointer;opacity:0.7;"><i class="fa-solid fa-plus"></i></span>
      </div>
      <div id="textChannelsList"></div>
    </div>

    <div class="channel-category" id="voiceChannelsCategory">
      <div class="category-header" onclick="toggleCategory(this)">
        <span><i class="fa-solid fa-chevron-down"></i></span>
        <span>VOICE CHANNELS</span>
        <span onclick="event.stopPropagation(); showModal('addVoiceChannel')" style="cursor:pointer;opacity:0.7;"><i class="fa-solid fa-plus"></i></span>
      </div>
      <div id="voiceChannelsList"></div>
    </div>
  </div>

  <div class="user-area">
    <div class="user-avatar" id="userAvatar">
      <span id="userAvatarText">U</span>
      <div class="user-status-indicator" id="userStatusIndicator"></div>
    </div>
    <div class="user-info">
      <div class="user-name" id="userName">User</div>
      <div class="user-status" id="userStatus">Online</div>
      <div class="user-voice-status" id="userVoiceStatus"></div>
    </div>
      <div class="user-controls" id="userControls">
        <button class="user-btn" onclick="toggleMute()" id="micBtn" title="Toggle Mute"><i class="fa-solid fa-microphone"></i></button>
        <button class="user-btn" onclick="toggleDeafen()" id="deafenBtn" title="Toggle Deafen"><i class="fa-solid fa-headphones"></i></button>
        <button class="user-btn" onclick="disconnectVoice()" id="leaveBtn" title="Leave Voice Channel" style="display: none;"><i class="fa-solid fa-phone-slash"></i></button>
        <button class="user-btn" onclick="showModal('settings')" title="User Settings"><i class="fa-solid fa-gear"></i></button>
      </div>
  </div>
</div>

<div class="chat-container" id="chatContainer">
  <div class="chat-header">
    <div class="chat-header-title">
      <span class="channel-icon" id="headerIcon">#</span>
      <span id="currentChannelName">general</span>
      <div class="header-divider" id="headerDivider" style="display:none;"></div>
      <span class="chat-header-topic" id="channelTopic"></span>
    </div>
    <div class="header-actions">
      <button class="header-btn" onclick="showModal('invite')" id="inviteBtn">
        <span><i class="fa-solid fa-envelope"></i></span> Invite
      </button>
      <button class="header-btn" onclick="showModal('invite')" id="discoveryJoinBtn" style="display:none;">
        <span><i class="fa-solid fa-plus"></i></span> Join Server
      </button>
      <button class="header-btn" onclick="backToServerChooser()" id="backToChooserBtn" style="display:none;">
        <span><i class="fa-solid fa-arrow-left"></i></span> Back
      </button>
      <button class="header-btn" onclick="toggleMemberList()" id="memberListBtn">
        <span><i class="fa-solid fa-users"></i></span> Members
      </button>
      <button class="header-btn" onclick="startDmVideoCall()" id="dmCallBtn" style="display:none;">
        <span><i class="fa-solid fa-video"></i></span> Video Call
      </button>
      <button class="header-btn" onclick="showModal('addFriend')" id="addFriendBtn" style="display:none;">
        <span><i class="fa-solid fa-user-plus"></i></span> Add Friend
      </button>
    </div>
  </div>

  <div class="voice-panel" id="voicePanel">
    <div class="voice-info">
      <span><i class="fa-solid fa-volume-high"></i></span>
      <span>Connected to <span class="voice-channel-name" id="voiceChannelName">General Voice</span></span>
    </div>
    <div class="voice-video-grid" id="voiceVideoGrid"></div>
      <div class="voice-controls">
        <button class="voice-btn" id="voicePanelToggleBtn" onclick="toggleVoicePanelMinimize()" title="Expand"><i class="fa-solid fa-up-right-and-down-left-from-center"></i></button>
        <button class="voice-btn" id="voiceVideoBtn" onclick="toggleCamera()" title="Camera"><i class="fa-solid fa-video"></i></button>
        <button class="voice-btn" id="voiceMuteBtn" onclick="toggleVoiceMute()" title="Mute"><i class="fa-solid fa-microphone"></i></button>
        <button class="voice-btn" id="voiceDeafenBtn" onclick="toggleDeafen()" title="Deafen"><i class="fa-solid fa-headphones"></i></button>
        <button class="voice-btn disconnect" onclick="disconnectVoice()" title="Disconnect"><i class="fa-solid fa-phone-slash"></i></button>
      </div>
  </div>
  <div class="messages-area" id="messagesArea">
    <div class="welcome-message" id="welcomeMessage">
      <h2>Welcome to <span id="welcomeServerName">Schoolcord</span></h2>
      <p>This is the beginning of the <strong>#general</strong> channel.</p>
    </div>
  </div>

  <div class="typing-indicator" id="typingIndicator">
    <div class="typing-dots">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>
    <span id="typingText">Someone is typing...</span>
  </div>

  <div class="message-input-area">
    <div class="message-input-wrapper">
      <div class="reply-composer" id="replyComposer">
        <div class="reply-composer-line">
          <span class="reply-composer-label">Replying to <span id="replyAuthor"></span></span>
          <button class="reply-composer-cancel" onclick="clearReplyComposer()" title="Cancel reply"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="reply-composer-snippet" id="replySnippet"></div>
      </div>
      <div class="message-input-container">
        <button class="attach-btn" onclick="document.getElementById('imageInput').click()" title="Upload Image"><i class="fa-solid fa-paperclip"></i></button>
        <input type="text" class="message-input" id="messageInput" placeholder="Message #general" maxlength="2000">
      </div>
      <div class="input-actions">
        <span class="char-count" id="charCount">0/2000</span>
        <button class="input-btn" onclick="showModal('createPoll')" id="pollBtn"><i class="fa-solid fa-square-poll-vertical"></i> Poll</button>
        <button class="input-btn" onclick="toggleVoiceRecording()" id="voiceRecordBtn"><i class="fa-solid fa-microphone"></i> Voice</button>
        <button class="input-btn" onclick="sendMessage()" id="sendBtn">Send Message</button>
        <input type="file" id="imageInput" accept="image/*" style="display:none;">
      </div>
    </div>
    <div class="slowmode-notice" id="slowmodeNotice" aria-live="polite"></div>
    <div class="command-dropdown" id="commandDropdown" style="display:none;"></div>
    <div class="mention-dropdown" id="mentionDropdown" style="display:none;"></div>
  </div>
</div>

<div class="member-list" id="memberList">
  <div id="membersContainer"></div>
</div>

<!-- DM Call -->
<div class="dm-call-overlay" id="dmCallOverlay" style="display:none;">
  <div class="dm-call-window">
    <div class="dm-call-header">
      <div class="dm-call-title" id="dmCallTitle">Video Call</div>
      <div style="display:flex;gap:8px;">
        <button class="action-btn" onclick="toggleDmCallMinimize()" title="Minimize"><i class="fa-solid fa-window-minimize"></i></button>
        <button class="action-btn delete" onclick="endDmCall()" title="End Call"><i class="fa-solid fa-phone-slash"></i></button>
      </div>
    </div>
    <div class="dm-call-videos">
      <video id="dmRemoteVideo" autoplay playsinline></video>
      <video id="dmLocalVideo" autoplay muted playsinline></video>
    </div>
    <div class="dm-call-controls">
      <button class="voice-btn" id="dmCallMicBtn" onclick="toggleDmCallMute()" title="Toggle Microphone"><i class="fa-solid fa-microphone"></i></button>
      <button class="voice-btn" id="dmCallCamBtn" onclick="toggleDmCallCamera()" title="Toggle Camera"><i class="fa-solid fa-video"></i></button>
      <button class="voice-btn" id="dmCallAudioBtn" onclick="toggleDmCallAudio()" title="Toggle Incoming Audio"><i class="fa-solid fa-volume-high"></i></button>
    </div>
  </div>
</div>
<div class="dm-call-incoming" id="dmCallIncoming" style="display:none;">
  <div class="dm-call-incoming-card">
    <div class="dm-call-incoming-title" id="dmCallIncomingName">Incoming video call</div>
    <div class="dm-call-incoming-actions">
      <button class="input-btn" onclick="acceptDmCall()">Accept</button>
      <button class="input-btn danger" onclick="declineDmCall()">Decline</button>
    </div>
  </div>
</div>
<div class="dm-call-mini-dock" id="dmCallMiniDock" style="display:none;">
  <div class="dm-call-mini-handle" id="dmCallMiniHandle" title="Drag call window"><i class="fa-solid fa-grip-lines"></i></div>
  <button class="dm-call-mini-main" onclick="restoreDmCall()">
    <i class="fa-solid fa-video"></i>
    <span id="dmCallMiniTitle">DM call</span>
  </button>
  <button class="voice-btn disconnect" onclick="endDmCall()" title="End Call"><i class="fa-solid fa-phone-slash"></i></button>
</div>

<!-- Modals -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">User Settings</div>
      <div class="modal-subtitle">Customize your profile</div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Username</label>
        <input type="text" class="modal-input" id="usernameInput" placeholder="Enter username" maxlength="32">
      </div>
      <div class="modal-input-group">
        <label class="modal-label">Bio</label>
        <textarea class="modal-input" id="bioInput" placeholder="Say something about you" maxlength="160" rows="3" style="resize: none;"></textarea>
      </div>
      <div class="modal-input-group">
        <label class="modal-label">Avatar</label>
        <div class="file-input-wrapper">
          <input type="file" id="avatarInput" accept="image/*">
          <label for="avatarInput" class="file-input-label" id="avatarLabel">Click to upload avatar</label>
        </div>
      </div>
      <div class="modal-input-group">
        <label class="modal-label">Status</label>
        <select class="modal-input" id="statusSelect">
          <option value="online">Online</option>
          <option value="idle">Idle</option>
          <option value="dnd">Do Not Disturb</option>
          <option value="offline">Invisible</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('settings')">Cancel</button>
      <button class="modal-btn primary" onclick="saveSettings()">Save Changes</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="welcomeModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Welcome to Schoolcord</div>
      <div class="modal-subtitle">Get started by creating or joining a server</div>
    </div>
    <div class="modal-body" style="text-align:center;padding:32px;">
        <div style="font-size:48px;margin-bottom:16px;"><i class="fa-solid fa-hand"></i></div>
      <p style="color:#949ba4;margin-bottom:24px;">You haven't joined any servers yet. Create your own server or join an existing one with an invite code.</p>
    </div>
    <div class="modal-footer" style="justify-content:center;gap:16px;">
      <button class="modal-btn primary" onclick="hideModal('welcome'); showModal('addServer')">Create My Server</button>
      <button class="modal-btn secondary" onclick="hideModal('welcome'); showModal('invite')">Join a Server</button>
      <button class="modal-btn secondary" onclick="hideModal('welcome'); goDiscovery()">Discover Servers</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="addServerModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Create Your Server</div>
      <div class="modal-subtitle">Give your new server a personality</div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Server Name *</label>
        <input type="text" class="modal-input" id="serverNameInput" placeholder="Enter server name" maxlength="100">
      </div>
      <div class="modal-input-group">
        <label class="modal-label">Server Icon</label>
        <div class="file-input-wrapper">
          <input type="file" id="serverIconInput" accept="image/*">
          <label for="serverIconInput" class="file-input-label" id="serverIconLabel">Click to upload server icon</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="backFromCreateServer()">Back</button>
      <button class="modal-btn primary" id="createServerBtn" onclick="createServer()">Create Server</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="serverChooserModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Add a Server</div>
      <div class="modal-subtitle">Create your own or join an existing one</div>
    </div>
    <div class="modal-body" style="display:flex;flex-direction:column;gap:12px;">
      <button class="modal-btn primary" onclick="hideModal('serverChooser'); showModal('addServer')">Create Server</button>
      <button class="modal-btn secondary" onclick="hideModal('serverChooser'); showModal('invite')">Join with Code</button>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('serverChooser')">Cancel</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="addChannelModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Create Text Channel</div>
      <div class="modal-subtitle">In <span id="addChannelServerName">Server</span></div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Channel Name *</label>
        <input type="text" class="modal-input" id="channelNameInput" placeholder="new-channel" maxlength="100">
        <small style="color:#949ba4;font-size:12px;margin-top:4px;display:block;">Use lowercase with hyphens (e.g., general-chat)</small>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('addChannel')">Cancel</button>
      <button class="modal-btn primary" onclick="createChannel()">Create Channel</button>
    </div>
  </div>
</div>

<!-- Add Friend Modal -->
<div class="modal-overlay" id="addFriendModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Add Friend</div>
      <div class="modal-subtitle">Enter a username to add them</div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Username</label>
        <input type="text" class="modal-input" id="friendUsernameInput" placeholder="Enter username" maxlength="32">
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('addFriend')">Cancel</button>
      <button class="modal-btn primary" onclick="addFriend()">Add Friend</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="addVoiceChannelModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Create Voice Channel</div>
      <div class="modal-subtitle">In <span id="addVoiceChannelServerName">Server</span></div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Channel Name *</label>
        <input type="text" class="modal-input" id="voiceChannelNameInput" placeholder="General Voice" maxlength="100">
      </div>
      <div class="modal-input-group">
        <label class="modal-label">User Limit (optional)</label>
        <input type="number" class="modal-input" id="voiceChannelLimit" placeholder="No limit" min="1" max="99">
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('addVoiceChannel')">Cancel</button>
      <button class="modal-btn primary" onclick="createVoiceChannel()">Create Channel</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="inviteModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="inviteModalTitle">Invite Friends</div>
      <div class="modal-subtitle" id="inviteModalSubtitle">Share your server with others</div>
    </div>
    <div class="modal-body">
      <div class="invite-section" id="inviteSection">
        <div class="invite-label">Server Invite Code</div>
        <div class="invite-code-box">
          <div class="invite-code" id="inviteCode">LOADING...</div>
          <button class="copy-btn" onclick="copyInviteCode()">Copy</button>
        </div>
      </div>
      <div class="modal-input-group" id="joinSection">
        <label class="modal-label">Or join a server</label>
        <input type="text" class="modal-input" id="joinCodeInput" placeholder="Enter invite code (e.g., ABC12345)" maxlength="8">
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="backFromInviteModal()" id="inviteBackBtn" style="display:none;">Back</button>
      <button class="modal-btn secondary" onclick="closeInviteModal()" id="inviteCloseBtn">Close</button>
      <button class="modal-btn primary" onclick="joinServer()" id="inviteJoinBtn">Join Server</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="createPollModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Create Poll</div>
      <div class="modal-subtitle">Ask a question and add options</div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Question</label>
        <input type="text" class="modal-input" id="pollQuestionInput" placeholder="What should we do?" maxlength="200">
      </div>
      <div class="modal-input-group">
        <label class="modal-label">Options (one per line, 2-8)</label>
        <textarea class="modal-input" id="pollOptionsInput" placeholder="Option 1&#10;Option 2&#10;Option 3" maxlength="800" rows="6" style="resize: vertical;"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('createPoll')">Cancel</button>
      <button class="modal-btn primary" onclick="createPollMessage()">Send Poll</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="startupUpdatesModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">New Stuff Added</div>
      <div class="modal-subtitle">Recent updates from this build</div>
    </div>
    <div class="modal-body">
      <div style="display:flex;flex-direction:column;gap:10px;color:#dcddde;font-size:14px;line-height:1.4;">
        <div><strong>Messaging:</strong> reply to messages, mentions + unread mention badges, slash command UI, and command autocomplete.</div>
        <div><strong>Commands:</strong> <code>/ai</code>, <code>/ping</code>, <code>/me</code>, <code>/shrug</code>, <code>/roll</code>, <code>/mc</code>, <code>/help</code>.</div>
        <div><strong>Embeds:</strong> URL embeds, server invite embeds with join button + server info, and image click-to-view.</div>
        <div><strong>Polls:</strong> create polls, end polls, and view exactly who voted per option.</div>
        <div><strong>Voice:</strong> voice messages with custom player UI (play/pause, bars, speed, volume), plus DM/VC call UI improvements.</div>
        <div><strong>Profiles:</strong> fixed PFP persistence/loading so avatars now stick correctly across refresh, messages, DMs, and member list.</div>
        <div style="color:#23a559;"><strong>Im Going Broke:</strong> I'm now paying Â£7/month for this.</div>
        <div><strong>Server/Data:</strong> duplicate/broken server cleanup, member-list-based server membership checks, and profile status/last-seen handling improvements.</div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="dismissStartupUpdates(false)">Close</button>
      <button class="modal-btn primary" onclick="dismissStartupUpdates(true)">Don't Show Again</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="manageChannelsModal">
  <div class="modal-content" style="width: 700px; max-width: 90vw;">
    <div class="modal-header">
      <div class="modal-title">Channel Settings</div>
      <div class="modal-subtitle">Manage permissions and settings for your channel</div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Select Channel</label>
        <select class="modal-input" id="channelSelect" onchange="loadChannelPermissions()"></select>
      </div>
      <div id="channelPermissions">
        <div class="modal-input-group">
          <label class="modal-label">View Permissions</label>
          <div id="viewPermissionsList" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;"></div>
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Send Messages</label>
          <div id="sendPermissionsList" style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;"></div>
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Channel Topic</label>
          <input type="text" class="modal-input" id="channelTopicInput" placeholder="Enter channel topic (optional)" maxlength="100">
        </div>
        <div class="modal-input-group">
          <label class="modal-label">Slowmode (seconds)</label>
          <input type="number" class="modal-input" id="channelSlowmodeInput" placeholder="0" min="0" max="3600">
        </div>

      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn danger" onclick="deleteChannel()">Delete Channel</button>
      <button class="modal-btn secondary" onclick="hideModal('manageChannels')">Cancel</button>
      <button class="modal-btn primary" onclick="saveChannelPermissions()">Save Changes</button>
    </div>
  </div>
</div>

<div class="dropdown-menu" id="serverMenu">
  <div class="dropdown-item" onclick="showModal('invite')">
    <span><i class="fa-solid fa-envelope"></i></span> Invite People
  </div>
  <div class="dropdown-item" onclick="showModal('addChannel')">
    <span><i class="fa-solid fa-plus"></i></span> Create Text Channel
  </div>
  <div class="dropdown-item" onclick="showModal('addVoiceChannel')">
    <span><i class="fa-solid fa-volume-high"></i></span> Create Voice Channel
  </div>
  <div class="dropdown-item" onclick="showModal('manageChannels')">
    <span><i class="fa-solid fa-gear"></i></span> Channel Settings
  </div>
  <div class="dropdown-item" onclick="showModal('serverSettings')">
    <span><i class="fa-solid fa-wrench"></i></span> Server Settings
  </div>
  <div class="dropdown-item" onclick="showModal('roles')">
    <span><i class="fa-solid fa-crown"></i></span> Manage Roles
  </div>
  <div class="dropdown-divider"></div>
  <div class="dropdown-item danger" onclick="leaveServer()">
    <span><i class="fa-solid fa-door-open"></i></span> Leave Server
  </div>
</div>

<!-- Server Settings Modal -->
<div class="modal-overlay" id="serverSettingsModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Server Settings</div>
      <div class="modal-subtitle">Customize your server</div>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label class="modal-label">Server Name</label>
        <input type="text" class="modal-input" id="serverSettingsName" placeholder="Enter server name" maxlength="100">
      </div>
      <div class="modal-input-group">
        <label class="modal-label">Server Description</label>
        <textarea class="modal-input" id="serverSettingsDescription" placeholder="Describe your server" maxlength="200" rows="3" style="resize: none;"></textarea>
      </div>
      <div class="modal-input-group">
        <label class="modal-label">System Messages Channel</label>
        <select class="modal-input" id="systemMessagesChannel"></select>
      </div>
      <div class="modal-input-group" style="display:flex;align-items:center;gap:8px;">
        <input type="checkbox" id="serverDiscoverable">
        <label class="modal-label" for="serverDiscoverable" style="margin:0;">List in Server Discovery</label>
      </div>
      <div class="modal-input-group">
        <label class="modal-label">Server Icon</label>
        <div class="file-input-wrapper">
          <input type="file" id="serverSettingsIcon" accept="image/*">
          <label for="serverSettingsIcon" class="file-input-label" id="serverSettingsIconLabel">Click to upload server icon</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('serverSettings')">Cancel</button>
      <button class="modal-btn primary" onclick="saveServerSettings()">Save Changes</button>
    </div>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- Roles Management Modal -->
<div class="modal-overlay" id="rolesModal">
  <div class="modal-content" style="width: 800px; max-width: 90vw;">
    <div class="modal-header">
      <div class="modal-title">Role Management</div>
      <div class="modal-subtitle">Create, edit, and manage server roles</div>
    </div>
    <div class="modal-body" style="display: flex; gap: 20px;">
      <div style="flex: 1;">
        <div class="modal-input-group">
          <label class="modal-label">Join Role (Default for new members)</label>
          <select class="modal-input" id="joinRoleSelect"></select>
        </div>
        
        <div class="modal-input-group" style="margin-top: 16px;">
          <label class="modal-label">Create New Role</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" class="modal-input" id="newRoleName" placeholder="Role name" maxlength="50" style="flex: 1;">
            <input type="color" id="newRoleColor" value="#5865f2" style="width: 60px; height: 40px; padding: 2px; border: none; cursor: pointer;">
            <button class="modal-btn primary" onclick="createNewRole()" style="flex-shrink: 0;">Create</button>
          </div>
        </div>

        <div style="margin-top: 24px;">
          <h4 style="color: #dbdee1; margin-bottom: 12px;">Existing Roles</h4>
          <div id="rolesList" style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto;"></div>
        </div>
      </div>
      
      <div style="flex: 1;">
        <h4 style="color: #dbdee1; margin-bottom: 12px;" id="editRoleTitle">Edit Role</h4>
        <div id="editRoleForm">
          <div class="modal-input-group">
            <label class="modal-label">Role Name</label>
            <input type="text" class="modal-input" id="editRoleName" placeholder="Enter role name" maxlength="50">
          </div>
          <div class="modal-input-group">
            <label class="modal-label">Role Color</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <input type="color" id="editRoleColor" value="#5865f2" style="width: 60px; height: 40px; padding: 2px; border: none; cursor: pointer;">
              <span id="editRoleColorPreview" style="flex: 1; padding: 8px; border-radius: 4px; background: #5865f2; color: white; text-align: center;">#5865f2</span>
            </div>
          </div>
          <div class="modal-input-group">
            <label class="modal-label">Permissions</label>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permManageChannels"> Manage Channels
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permManageMessages"> Manage Messages
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permManageRoles"> Manage Roles
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permSendMessages"> Send Messages
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permViewChannels"> View Channels
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permManageServer"> Manage Server
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permMentionEveryone"> Mention @here/@everyone
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permUseCommands"> Use Slash Commands
              </label>
              <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
                <input type="checkbox" id="permHoist"> Hoist Role
              </label>
            </div>
          </div>
          <div style="display: flex; gap: 8px; margin-top: 16px;">
            <button class="modal-btn secondary" onclick="clearEditRole()">Cancel</button>
            <button class="modal-btn primary" onclick="saveEditRole()">Save Changes</button>
            <button class="modal-btn danger" onclick="deleteRole()" id="deleteRoleBtn" style="margin-left: auto;">Delete Role</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn secondary" onclick="hideModal('roles')">Close</button>
    </div>
  </div>
</div>
</body>
</html>
